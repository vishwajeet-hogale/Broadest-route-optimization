<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=\, initial-scale=1.0" />
    <meta http-equiv="X-UA-Compatible" content="ie=edge" />
    <link
      rel="stylesheet"
      href="https://unpkg.com/leaflet@1.4.0/dist/leaflet.css"
      integrity="sha512-puBpdR0798OZvTTbP4A8Ix/l+A4dHDD0DGqYW6RQ+9jxkRFclaxxQb/SJAWZfWAkuyeQUytO7+7N4QKrDh+drA=="
      crossorigin=""
    />

    <script
      src="https://unpkg.com/leaflet@1.4.0/dist/leaflet.js"
      integrity="sha512-QVftwZFqvtRNi0ZyCtsznlKSWOStnDORoefr1enyq5mVL4tmKB3S/EnC3rRJcxCPavG10IcrVGSmPh6Qw5lwrg=="
      crossorigin=""
    ></script>
    <title>Navigation by MB</title>

    <link rel="apple-touch-icon" sizes="180x180" href="static/images/favicons/apple-touch-icon.png">
    <link rel="icon" type="image/png" sizes="32x32" href="static/images/favicons/favicon-32x32.png">
    <link rel="icon" type="image/png" sizes="16x16" href="static/images/favicons/favicon-16x16.png">
    <link rel="manifest" href="static/images/favicons/site.webmanifest">

    <meta title="Navigation by MB"/>
    <meta name="description" content="Navigate your mercedes through the best route suggested by Navigation by MB">

    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Nanum+Myeongjo&display=swap" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Roboto+Slab:wght@100;500&display=swap" rel="stylesheet">
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
    <script src="https://maxcdn.bootstrapcdn.com/bootstrap/3.4.1/js/bootstrap.min.js"></script> 
    <link rel="stylesheet" href="https://bootswatch.com/4/materia/bootstrap.min.css"> 
    <link rel="stylesheet" href="static/css/maps.css"> 
    <title>Our map</title>
    <script src="static/js/maps.js"></script>
  </head>
  <body>
    <div class="d-flex flex-row flex-md-row justify-content-between align-items-center p-3 px-md-4 mb-3 bg-dark border-bottom box-shadow" style="color: whitesmoke;">
        <h5 style="width: 100%;" class="my-0 mr-md-auto header_MB">Navigation</h5>
        <img src="static/images/logo.png" width="40" height="40"/>
        <div style="width: 100%;" class="d-none d-md-block"></div>
      </div>
    <div>

    <div class="d-flex flex-md-row flex-column justify-content-center align-items-center" style="height: 80vh;">
      <div id="issMap"></div>
      <form onsubmit="onSubmit(event)">
        <h2>Plan your Route</h2>
        <label for="source">Source:</label><br>
        <select id="source" name="source">
          <option value="location1">Location 1</option>
          <option value="location2">Location 2</option>
          <option value="location3">Location 3</option>
        </select>
        <br/>
        <label for="destination">Destination:</label><br>
        <select id="destination" name="destination">
          <option value="location1">Location 1</option>
          <option value="location2">Location 2</option>
          <option value="location3">Location 3</option>
        </select>
        <br/>
        <input type="submit" value="Plan Route">
      </form>
      
    </div>
    <div id="result"></div>

    <!-- <script src="static/js/maps.js" lat = {{lat}} long = {{long}} origin = {{origin}} dest = {{dest}}> </script>     -->
    <script>
      var lat ={{lat}};
var long = {{long}};
var origin = {{origin}};
var dest = {{dest}};


var box = document.getElementById("box");

async function getAdd(lat, long) {
  url =
    "https://nominatim.openstreetmap.org/reverse?format=jsonv2&lat=" +
    lat +
    "&lon=" +
    long;
  const response = await fetch(url);
  const data = await response.json();
  roadname = data["display_name"];
  return roadname;
}

async function getISS(o_lat, o_long, d_lat, d_long) {
  url =
    "https://api.tomtom.com/routing/1/calculateRoute/" +
    o_lat +
    "," +
    o_long +
    ":" +
    d_lat +
    "," +
    d_long +
    "/json?key=mHywp1xqUaq62ROfTAuCRKtxjTYA0Zak&routeType=shortest";
  const response = await fetch(url);
  const data = await response.json();
  console.log(data);
  avg = data["routes"][0]["summary"]["lengthInMeters"];
  time_sec = data["routes"][0]["summary"]["travelTimeInSeconds"];
  list = [avg, time_sec];
  return list;
}

const mymap = L.map("issMap").setView(origin, 13);
const attribution =
  '&copy; <a href="https://www.openstreetmap.org/copyright">OpenStreetMap</a> contributors';

const tileUrl = "https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png";
const tiles = L.tileLayer(tileUrl, { attribution });

tiles.addTo(mymap);
const marker = L.marker(origin);
marker.addTo(mymap);
marker.bindPopup("Origin").openPopup();

const marker1 = L.marker(dest);
marker1.addTo(mymap);
marker1.bindPopup("Destination").openPopup();
var i = 0;
console.log(long.length);
for (i = 0; i < lat.length; i++) {
  const circle = L.circle([lat[i], long[i]], {
    color: "yellow",
    fillColor: "yellow",
    fillOpacity: 0.5,
    radius: 35,
  });
  circle.addTo(mymap);
}

const issIcon = L.icon({
  iconUrl: "{{url_for('static',filename='images/amb.png')}}",
  iconSize: [50, 32],
  iconAnchor: [25, 16],
});
let marker3 = L.marker(origin, { icon: issIcon }).addTo(mymap);

let yo = [];

var i = 0,
  x = 0;
a = setInterval(function () {
  mymap.removeLayer(marker3);
  marker3 = L.marker([lat[i], long[i]], { icon: issIcon });
  marker3.addTo(mymap);

  const circle2 = L.circle([lat[i], long[i]], {
    color: "black",
    fillColor: "yellow",
    fillOpacity: 0.5,
    radius: 2,
  });
  circle2.addTo(mymap);
  i++;
}, 300);

    </script>
      
      
  </body>
</html>